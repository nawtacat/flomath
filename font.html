<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Handwriter Font Creator</title>
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>
    <style>
        :root {
            --primary: #4a90e2;
            --bg: #f4f7f6;
        }
        body { font-family: system-ui, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; max-width: 500px; width: 100%; }
        canvas { border: 2px dashed #ccc; border-radius: 8px; cursor: crosshair; background: #fff; touch-action: none; }
        .controls { margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        .btn-next { background: var(--primary); color: white; }
        .btn-clear { background: #e74c3c; color: white; }
        .btn-download { background: #2ecc71; color: white; grid-column: span 2; margin-top: 10px; }
        button:hover { opacity: 0.8; }
        .status { margin-bottom: 15px; font-size: 1.2rem; }
        small { color: #666; display: block; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Math Font Maker</h2>
        <div class="status">
            Draw the symbol: <strong id="currentChar">0</strong>
        </div>
        
        <canvas id="paintCanvas" width="400" height="400"></canvas>
        
        <div class="controls">
            <button class="btn-clear" onclick="clearCanvas()">Clear</button>
            <button class="btn-next" onclick="nextChar()">Next Character</button>
            <button class="btn-download" onclick="downloadFont()">Download .OTF Font</button>
        </div>
        <small id="progress">Character 1 of 34</small>
    </div>

<script>
    const canvas = document.getElementById('paintCanvas');
    const ctx = canvas.getContext('2d');
    const charDisplay = document.getElementById('currentChar');
    const progressDisplay = document.getElementById('progress');
    
    // The "High School Math" character set
    const mathChars = "0123456789+-*/=<>(){}[].,^%√πθΔ∑∞".split('');
    let currentIndex = 0;
    let glyphs = [];
    let currentPath = [];
    let isDrawing = false;

    // Canvas Logic
    ctx.lineWidth = 15;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000';

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    window.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);

    function startDrawing(e) {
        isDrawing = true;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
        currentPath.push(['M', pos.x, pos.y]);
    }

    function draw(e) {
        if (!isDrawing) return;
        const pos = getPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        currentPath.push(['L', pos.x, pos.y]);
    }

    function stopDrawing() {
        if (isDrawing) currentPath.push(['Z']);
        isDrawing = false;
    }

    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        currentPath = [];
    }

    function nextChar() {
        if (currentPath.length > 0) {
            saveGlyph(mathChars[currentIndex], currentPath);
        }
        
        currentIndex++;
        if (currentIndex < mathChars.length) {
            updateUI();
            clearCanvas();
        } else {
            alert("All characters drawn! You can now download your font.");
            currentIndex = mathChars.length - 1;
        }
    }

    function updateUI() {
        charDisplay.innerText = mathChars[currentIndex];
        progressDisplay.innerText = `Character ${currentIndex + 1} of ${mathChars.length}`;
    }

    function saveGlyph(char, pathData) {
        // Convert canvas coordinates to Font coordinates (1000 units scale)
        const scale = 1000 / 400;
        const p = new opentype.Path();
        
        pathData.forEach(cmd => {
            if (cmd[0] === 'M') p.moveTo(cmd[1] * scale, 1000 - (cmd[2] * scale));
            else if (cmd[0] === 'L') p.lineTo(cmd[1] * scale, 1000 - (cmd[2] * scale));
            else if (cmd[0] === 'Z') p.closePath();
        });

        const glyph = new opentype.Glyph({
            name: char,
            unicode: char.charCodeAt(0),
            advanceWidth: 650,
            path: p
        });
        glyphs.push(glyph);
    }

    function downloadFont() {
        if (glyphs.length === 0) return alert("Draw some characters first!");

        // Add a basic NotDef glyph (required)
        const notdefGlyph = new opentype.Glyph({
            name: '.notdef',
            unicode: 0,
            advanceWidth: 650,
            path: new opentype.Path()
        });

        const font = new opentype.Font({
            familyName: 'MyMathHandwriting',
            styleName: 'Medium',
            unitsPerEm: 1000,
            ascender: 800,
            descender: -200,
            glyphs: [notdefGlyph, ...glyphs]
        });

        font.download();
    }
</script>
</body>
</html>
